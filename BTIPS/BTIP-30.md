
```
BTIP: 30
title: Support backup and recovery of BTFS data
author: Shawn-Huang-Tron<shawn.huang@tron.network>
discussions-to: https://github.com/bittorrent/BTIPs/issues/30
status: Idea
type: Client API
category (*only required for Core Protocol): 
created: 2023-07-20
```

## Simple Summary

Before BTFS v2.3.2, if we want to migrate our BTFS node, we need to stop our daemon, and then tar our .btfs directory. After we install a new BTFS node, copy the tar file we have done before and untar it into the .btfs directory in the new machine. It's error-prone and requires expertise. The person who doesn't know BTFS well won't know how to do this backup and recovery.

So, as mentioned above, we hope that some commands can help us to backup our node's data and recover it in another machine easily, such as:

``` shell
btfs backup -o ./btfs_backup

btfs recovery  -r ./btfs_backup.tar.gz
```

## Abstract

BTFS should provide some kind of command to back up and recover BTFS data.

## Motivation

This BTIP can help the BTFS users back up the BTFS node's data and recover it in another machine easily.

## Specification

This BTIP will simplify the process of backup and recovery by providing the following commands:

```shell
btfs backup -o ./btfs_backup

btfs recovery  -r ./btfs_backup.tar.gz
```

1. The `backup` command will back up the data of the current BTFS node, and option `-o` indicates the output file name and its path position, default file name is btfs_backup_{{timestamp}}.tar.gz if not specific. If `-a zip` specific, then it will be btfs_backup_{{timestamp}}.zip. And if `--exclude` is specific, some directories will not be backup, its optional value is `config`/`statestore`/`datastore`.
2. The `recovery` command will recover the data from resource option `-r` and it should be an archived file probably generated by the `backup` command. And option `-p` will unarchive it into the .btfs or the path which indicates by env `BTFS_PATH` by default, so it is optional.

**NOTE:** If you don't know what `--exclude` exactly means, just don't specify, it may cause some data loss

## Rationale

1. The `backup` will detect if `btfs daemon` is running avoid to the backup of the repo lock.
2. If btfs is running, `backup` will tell you to stop the btfs daemon process.
3. Or else `backup` will continue to proceed, now it will see if env `BTFS_PATH` exists.
4. If yes, view this env value as the target path, or not it will use `~/.btfs` as the default target path.
5. The `backup` will try to archive the target path above into the option `-o`; if it succeeds, `backup` is done.
6. The `recovery` will detect if btfs is inited(We recommend that you don't init btfs in the new machine if you want to recover it).
7. Also, `recovery` will judge if `btfs daemon` is running and do what `backup` will do.
8. If btfs is not inited, `recovery` will recover the archived file which is indicated by option `-r` into the btfs data path(env `BTFS_PATH` if it exists or `~/.btfs`).
9. Also, `btfs init --recovery ./btfs_backup.tar.gz` is a good idea to recover file.

## Backwards Compatibility

YES. The output of `backup` will contain a BTFS version info so that the `recovery` can deal with that. Every version of BTFS after this BTIP should guarantee the compatibility of the `recovery`.

## Test Cases

## Implementation
